{% extends 'blog/base.html' %}
{% load static %}
{% block content %}
<div class="container mt-5">
  <h2>ðŸ“Š Blog Statistics</h2>


  <div class="col-lg-10">
    <div class="card p-4 my-4">

      <h5><strong>Overview Of All Posts</strong></h5>
      <p class="text-muted">Views</p>
      <canvas id="mainChart"></canvas>

      <div class="mt-2">
        <span><strong>{{ total_views }}</strong> <i class="fa fa-eye"></i></span>
      </div>

    </div>
  </div>

  <div class="col-lg-10">
    <div class="card p-3">

      <h5>Posts</h5>
      
      {% for post in posts %}
        <div class="d-flex justify-content-between align-items-center border-bottom py-2">
      
          <div>
            {% if post.thumbnail %}
              <img src="{{ post.thumbnail.url }}" alt="Thumbnail" width="40" class="me-2">
            {% else %}
              <img src="{% static 'images/default-thumbnail.jpg' %}"  width="40" class="me-2">
            {% endif %}
            <strong>{{ post.title }}</strong>
          </div>
      
          <div>
            {{ post.postview_set.count }} <i class="fa fa-eye"></i>
          </div>
      
        </div>
      {% endfor %}
    
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('mainChart').getContext('2d');
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ labels|safe }},
      datasets: [
        {
          label: 'Views',
          data: {{ views|safe }},
          borderColor: 'deepskyblue',
          backgroundColor: 'rgba(30,144,255,0.1)',
          fill: true,
          tension: 0.3
        },
        {
          label: 'Likes',
          data: {{ likes|safe }},
          borderColor: 'red',
          backgroundColor: 'rgba(255,0,0,0.05)',
          fill: false,
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

{% endblock %}
